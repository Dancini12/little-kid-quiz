<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Little Kid Quiz - Marcel</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tone.js -->
    <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>

    <!-- Fonte Pixel -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        .pixel-font {
            font-family: 'Press Start 2P', monospace;
        }

        .iris-out {
            animation: irisOut 0.6s ease-in-out forwards;
        }

        .iris-in {
            animation: irisIn 0.6s ease-in-out forwards;
        }

        @keyframes irisOut {
            from {
                clip-path: circle(150% at 50% 50%);
            }

            to {
                clip-path: circle(0% at 50% 50%);
            }
        }

        @keyframes irisIn {
            from {
                clip-path: circle(0% at 50% 50%);
            }

            to {
                clip-path: circle(150% at 50% 50%);
            }
        }

        @keyframes walk {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-4px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .assistente-fixo {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99999;
            width: 150px;
            height: 180px;
            image-rendering: pixelated;
        }
    </style>

</head>

<body class="bg-black">
    <div id="root"></div>

    <!-- Assistente Fixo -->
    <div id="assistente-container" class="assistente-fixo flex items-end justify-center">
        <img id="assistente-img" src="idle.png" style="width:130px;" />
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {

            // Estado geral de telas
            const [screen, setScreen] = useState("prestart");

            // Assistente
            const [assistantMood, setAssistantMood] = useState("idle");

            // √Åudio
            const [audioEnabled, setAudioEnabled] = useState(false);
            const synthRef = useRef(null);

            // Ativar √°udio
            const enableAudio = async () => {
                try {
                    await Tone.start();
                    if (!synthRef.current) {
                        synthRef.current = new Tone.Synth({
                            oscillator: { type: "square" },
                            envelope: { attack: 0.02, decay: 0.1, sustain: 0.3, release: 0.2 }
                        }).toDestination();
                    }
                    setAudioEnabled(true);
                } catch (e) {
                    console.warn("Erro ao iniciar √°udio:", e);
                }
            };

            // Som moeda
            const playCoin = () => {
                if (!audioEnabled || !synthRef.current) return;
                const now = Tone.now();
                synthRef.current.triggerAttackRelease("B5", "0.05", now);
                synthRef.current.triggerAttackRelease("E6", "0.15", now + 0.05);
            };

            // Trocar humor do assistente
            const updateMood = (m) => {
                setAssistantMood(m);
                const img = document.getElementById("assistente-img");

                if (m === "idle") img.src = "idle.png";
                if (m === "happy") img.src = "happy.png";
                if (m === "sad") img.src = "sad.png";
            };

            // =============================================================
            //                        TELA PRESTART
            // =============================================================
            if (screen === "prestart") {
                return (
                    <div className="min-h-screen bg-black text-white flex flex-col items-center justify-center iris-in">
                        <h1 className="pixel-font text-4xl mb-10 animate-pulse">
                            PRESS START
                        </h1>

                        <button
                            onClick={async () => {
                                await enableAudio();
                                playCoin();
                                updateMood("idle");
                                setScreen("splash");
                            }}
                            className="bg-white text-black font-bold px-10 py-5 rounded-lg text-2xl border-4 border-gray-400 hover:scale-110 transition-all pixel-font"
                        >
                            START
                        </button>
                    </div>
                );
            }

            // =============================================================
            //                            SPLASH
            // =============================================================
            if (screen === "splash") {

                useEffect(() => {
                    const t = setTimeout(() => setScreen("menu"), 2600);
                    return () => clearTimeout(t);
                }, []);

                return (
                    <div className="min-h-screen bg-black text-white flex flex-col items-center justify-center iris-out">
                        <h1 className="pixel-font text-5xl mb-4">MARCEL DANCINI</h1>
                        <p className="pixel-font text-2xl">Presents</p>
                    </div>
                );
            }

            // =============================================================
            //                              MENU
            // =============================================================
            if (screen === "menu") {
                updateMood("idle");

                return (
                    <div className="min-h-screen iris-in bg-gradient-to-b from-blue-400 via-blue-300 to-green-400 p-8">

                        {/* Bot√£o som */}
                        <button
                            onClick={() => enableAudio()}
                            className="fixed top-6 right-6 bg-yellow-400 border-4 border-yellow-700 text-black p-4 rounded-full shadow-xl pixel-font"
                        >
                            üîä
                        </button>

                        <div className="max-w-4xl mx-auto">

                            <h1 className="text-5xl md:text-6xl text-center text-yellow-300 font-bold pixel-font mb-10"
                                style={{ textShadow: "6px 6px 0px rgba(0,0,0,0.5)" }}>
                                QUIZ DO CONHECIMENTO
                            </h1>

                            <div className="space-y-6">

                                <button
                                    onClick={() => setScreen("config")}
                                    className="w-full bg-gradient-to-r from-orange-500 to-orange-600 border-4 border-orange-800 text-white font-bold pixel-font py-6 px-8 rounded-lg shadow-xl hover:scale-105 transition-all text-xl md:text-2xl"
                                >
                                    ‚≠ê INICIAR JOGO
                                </button>

                                <button
                                    onClick={() => setScreen("ranking")}
                                    className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 border-4 border-yellow-800 text-white font-bold pixel-font py-6 px-8 rounded-lg shadow-xl hover:scale-105 transition-all text-xl md:text-2xl"
                                >
                                    üèÜ VER RANKING
                                </button>

                            </div>
                        </div>
                    </div>
                );
            }

            // =============================================================
            //                       CONFIGURA√á√ïES
            // =============================================================
            const [player1Name, setPlayer1] = useState("Jogador");
            const [difficulty, setDifficulty] = useState("F√°cil");

            if (screen === "config") {
                updateMood("idle");

                return (
                    <div className="min-h-screen iris-in bg-gradient-to-b from-blue-400 to-green-400 p-8">

                        <div className="max-w-3xl mx-auto bg-white border-8 border-gray-800 rounded-lg p-8 shadow-2xl">

                            <h2 className="pixel-font text-3xl text-center mb-6 text-red-600">
                                ‚öôÔ∏è CONFIGURA√á√ïES
                            </h2>

                            <div className="space-y-6">

                                <input type="text"
                                    className="w-full px-4 py-3 border-4 border-gray-600 rounded-lg text-lg font-bold"
                                    value={player1Name}
                                    onChange={(e) => setPlayer1(e.target.value)}
                                    placeholder="Nome do Jogador"
                                />

                                <label className="pixel-font text-lg">Dificuldade:</label>
                                <div className="flex gap-3">
                                    {["F√°cil", "M√©dio", "Dif√≠cil"].map(d => (
                                        <button key={d}
                                            onClick={() => setDifficulty(d)}
                                            className={`flex-1 py-3 rounded-lg border-4 font-bold pixel-font
                                                ${difficulty === d ? "bg-blue-500 text-white" : "bg-gray-200"}`}>
                                            {d}
                                        </button>
                                    ))}
                                </div>

                            </div>

                            <div className="flex gap-4 mt-6">
                                <button
                                    onClick={() => setScreen("menu")}
                                    className="flex-1 bg-gray-500 text-white font-bold pixel-font py-4 rounded-lg text-xl"
                                >
                                    ‚Üê VOLTAR
                                </button>

                                <button
                                    onClick={() => setScreen("loading")}
                                    className="flex-1 bg-green-500 text-white font-bold pixel-font py-4 rounded-lg text-xl"
                                >
                                    COME√áAR ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // =============================================================
            //                             LOADING
            // =============================================================
            const [dots, setDots] = useState(0);

            if (screen === "loading") {

                useEffect(() => {
                    updateMood("idle");

                    const interval = setInterval(() => {
                        setDots((d) => (d + 1) % 4);
                    }, 400);

                    const timeout = setTimeout(() => {
                        setScreen("question");
                    }, 2000);

                    return () => {
                        clearInterval(interval);
                        clearTimeout(timeout);
                    };
                }, []);

                return (
                    <div className="min-h-screen bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center">
                        <div className="text-center">

                            <img src="idle.png"
                                className="mx-auto mb-6"
                                style={{
                                    width: "150px",
                                    animation: "walk 0.4s infinite steps(2)",
                                    imageRendering: "pixelated"
                                }}
                            />

                            <h2 className="text-3xl pixel-font text-white">
                                Gerando pergunta{".".repeat(dots)}
                            </h2>
                        </div>
                    </div>
                );
            }

            // =============================================================
            //                            QUESTION
            // =============================================================
            const [question, setQuestion] = useState(null);
            const [selected, setSelected] = useState(null);
            const [score, setScore] = useState(0);
            const [lives, setLives] = useState(3);
            const [runX, setRunX] = useState(5);

            const loadQuestion = () => {
                updateMood("idle");

                setQuestion({
                    pergunta: "Qual √© o plural de 'cora√ß√£o'?",
                    alternativas: {
                        A: "Cora√ß√µes",
                        B: "Cora√ß√£os",
                        C: "Cora√ß√µesz",
                        D: "Cora√ß√£oses",
                    },
                    correta: "A",
                    explicacao: "O plural de 'cora√ß√£o' segue a regra: -√£o ‚Üí -√µes.",
                });
                setSelected(null);
            };

            useEffect(() => {
                if (screen === "question") {
                    loadQuestion();
                }
            }, [screen]);

            const [showPopup, setShowPopup] = useState(false);

            const checkAnswer = () => {
                if (!selected) return alert("Escolha uma alternativa!");

                if (selected === question.correta) {
                    updateMood("happy");
                    playCoin();
                    setScore(score + 10);
                    setRunX(runX + 10);
                } else {
                    updateMood("sad");
                    setLives(lives - 1);
                }

                setShowPopup(true);
            };

            const continueGame = () => {
                setShowPopup(false);

                if (lives <= 0) {
                    setScreen("gameover");
                    return;
                }

                loadQuestion();
            };

            if (screen === "question" && question) {
                return (
                    <div className="min-h-screen bg-blue-200 p-6">

                        <div className="flex justify-between text-xl mb-4 pixel-font">
                            <div>‚ù§Ô∏è Vidas: {lives}</div>
                            <div>‚≠ê Pontos: {score}</div>
                        </div>

                        <div className="relative bg-blue-400 h-32 rounded-lg mb-6 overflow-hidden border-4 border-blue-800">
                            <img src={assistantMood === "happy" ? "happy.png" :
                                assistantMood === "sad" ? "sad.png" : "idle.png"}
                                style={{
                                    width: "60px",
                                    position: "absolute",
                                    bottom: 0,
                                    left: `${runX}%`,
                                    imageRendering: "pixelated",
                                    animation: "walk 0.35s infinite steps(2)"
                                }}
                            />
                        </div>

                        <div className="bg-yellow-300 border-8 border-yellow-600 rounded-lg p-4 mb-4 text-black">
                            <h2 className="pixel-font text-2xl mb-2">PERGUNTA</h2>
                            <p className="text-xl">{question.pergunta}</p>
                        </div>

                        <div className="space-y-3">
                            {Object.entries(question.alternativas).map(([key, value]) => (
                                <button key={key}
                                    onClick={() => setSelected(key)}
                                    className={`w-full p-4 rounded-lg border-4 font-bold text-lg pixel-font
                                        ${selected === key ? "bg-red-500 border-red-700 text-white"
                                            : "bg-orange-400 border-orange-600 text-black"}`}>
                                    {key}) {value}
                                </button>
                            ))}
                        </div>

                        <button
                            onClick={checkAnswer}
                            className="w-full pixel-font bg-green-500 text-black font-bold mt-6 py-4 rounded-lg text-2xl border-4 border-green-800 hover:scale-105 transition-all"
                        >
                            RESPONDER
                        </button>

                        {showPopup && (
                            <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-6">
                                <div className="bg-white border-8 border-gray-800 rounded-lg p-8 max-w-lg text-center shadow-2xl">
                                    <h2 className="text-3xl pixel-font mb-4">
                                        {selected === question.correta ? "‚úîÔ∏è Acertou!" : "‚ùå Errou!"}
                                    </h2>

                                    <p className="text-lg mb-4">{question.explicacao}</p>

                                    <button
                                        onClick={continueGame}
                                        className="w-full bg-blue-500 text-white pixel-font border-4 border-blue-800 py-4 text-xl rounded-lg hover:scale-105 transition-all"
                                    >
                                        CONTINUAR
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            // =============================================================
            //                             GAME OVER
            // =============================================================
            if (screen === "gameover") {
                updateMood("sad");

                return (
                    <div className="min-h-screen bg-black text-white flex flex-col items-center justify-center iris-in">

                        <h1 className="pixel-font text-5xl mb-6 text-red-500">
                            GAME OVER
                        </h1>

                        <p className="text-3xl pixel-font mb-4">
                            Pontua√ß√£o final: {score}
                        </p>

                        <button
                            onClick={() => {
                                setScore(0);
                                setLives(3);
                                setRunX(5);
                                updateMood("idle");
                                setScreen("menu");
                            }}
                            className="mt-6 bg-green-500 text-black pixel-font px-10 py-5 text-2xl rounded-lg border-4 border-green-800 hover:scale-110 transition-all"
                        >
                            VOLTAR AO MENU
                        </button>
                    </div>
                );
            }

            // =============================================================
            //                             RANKING
            // =============================================================
            const rankingList = [
                { nome: "Mario", pontos: 70 },
                { nome: "Luigi", pontos: 50 },
                { nome: "Peach", pontos: 40 },
                { nome: "Toad", pontos: 20 }
            ];

            if (screen === "ranking") {
                updateMood("idle");

                return (
                    <div className="min-h-screen iris-in bg-gradient-to-b from-yellow-300 to-yellow-500 p-10">

                        <h1 className="pixel-font text-4xl text-center mb-8">
                            üèÜ RANKING
                        </h1>

                        <div className="max-w-xl mx-auto bg-white border-8 border-gray-800 rounded-lg p-8 shadow-2xl">

                            <ul className="space-y-4 text-xl">
                                {rankingList.map((p, i) => (
                                    <li key={i}
                                        className="pixel-font bg-gray-200 border-4 border-gray-600 p-4 rounded-lg flex justify-between">
                                        <span>{i + 1}. {p.nome}</span>
                                        <span>{p.pontos} pts</span>
                                    </li>
                                ))}
                            </ul>

                            <button
                                onClick={() => setScreen("menu")}
                                className="w-full mt-8 bg-blue-500 text-white pixel-font border-4 border-blue-800 py-4 text-xl rounded-lg hover:scale-105 transition-all"
                            >
                                VOLTAR
                            </button>
                        </div>
                    </div>
                );
            }

            return null;
        }

        ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>

</body>
</html>
