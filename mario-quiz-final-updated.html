<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Quiz do Conhecimento - Mario Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        .pixel-font {
            font-family: 'Press Start 2P', monospace;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes rainbow {
            0% { filter: drop-shadow(4px 8px 12px rgba(255,0,0,0.6)) hue-rotate(0deg); }
            25% { filter: drop-shadow(4px 8px 12px rgba(255,255,0,0.6)) hue-rotate(90deg); }
            50% { filter: drop-shadow(4px 8px 12px rgba(0,255,0,0.6)) hue-rotate(180deg); }
            75% { filter: drop-shadow(4px 8px 12px rgba(0,0,255,0.6)) hue-rotate(270deg); }
            100% { filter: drop-shadow(4px 8px 12px rgba(255,0,0,0.6)) hue-rotate(360deg); }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes walk {
            0% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
            100% { transform: translateY(0); }
        }
        
        @keyframes irisOut {
            from { clip-path: circle(150% at 50% 50%); }
            to { clip-path: circle(0% at 50% 50%); }
        }
        
        @keyframes irisIn {
            from { clip-path: circle(0% at 50% 50%); }
            to { clip-path: circle(150% at 50% 50%); }
        }
        
        .iris-out {
            animation: irisOut 0.5s ease-in-out forwards;
        }
        
        .iris-in {
            animation: irisIn 0.5s ease-in-out forwards;
        }
    </style>
<style>
.littlekid {
  width: 90px;
  height: auto;
  image-rendering: pixelated;
  animation: bounce 1.2s infinite ease-in-out;
  position: relative;
}
@keyframes bounce {
  0%   { transform: translateY(0px); }
  50%  { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}
</style></head>
<body class="m-0 p-0">
<div id="root"></div>
<script crossorigin="" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin="" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function MarioQuizGame() {
            // Estados principais
            const [screen, setScreen] = useState('prestart');
            const [gameMode, setGameMode] = useState('1P');
            const [player1Name, setPlayer1Name] = useState('Mario');
            const [player2Name, setPlayer2Name] = useState('Luigi');
            const [subject, setSubject] = useState('Portugu√™s');
            const [grade, setGrade] = useState('7¬∫ ano');
            const [topic, setTopic] = useState('Verbos');
            const [difficulty, setDifficulty] = useState('F√°cil');
            
            // Estados do jogo
            const [player1Score, setPlayer1Score] = useState(0);
            const [player2Score, setPlayer2Score] = useState(0);
            const [currentPlayer, setCurrentPlayer] = useState(1);
            const [lives, setLives] = useState(3);
            const [streak, setStreak] = useState(0);
            const [totalQuestions, setTotalQuestions] = useState(0);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [selectedAnswer, setSelectedAnswer] = useState('');
            const [coins, setCoins] = useState(0);
            const [marioPosition, setMarioPosition] = useState(10);
            
            // Estados de UI
            const [isGenerating, setIsGenerating] = useState(false);
            const [dots, setDots] = useState(0);
            const [showExplanation, setShowExplanation] = useState(false);
            const [explanationData, setExplanationData] = useState({ correct: false, text: '' });
            const [ranking, setRanking] = useState([]);
            const [recordSaved, setRecordSaved] = useState(false);
            const [fadeOut, setFadeOut] = useState(false);
            const [isTransitioning, setIsTransitioning] = useState(false);
            
            // Estados de √°udio
            const [soundEnabled, setSoundEnabled] = useState(true);
            const [audioInitialized, setAudioInitialized] = useState(false);
            
            // Refs
            const synthRef = useRef(null);
            const bgMusicRef = useRef(null);
            const bgMusicPartRef = useRef(null);

            // Efeito para pontos de loading
            useEffect(() => {
                if (isGenerating) {
                    const interval = setInterval(() => setDots(d => (d + 1) % 4), 400);
                    return () => clearInterval(interval);
                }
            }, [isGenerating]);

            // Efeito para movimento do Mario
            useEffect(() => {
                if (screen === 'question' && marioPosition < 85) {
                    const interval = setInterval(() => {
                        setMarioPosition(p => Math.min(p + 0.5, 85));
                    }, 100);
                    return () => clearInterval(interval);
                }
            }, [screen, marioPosition]);

            // Efeito para salvar ranking
            useEffect(() => {
                if (screen === 'gameover' && !recordSaved && totalQuestions > 0) {
                    const finalScore = gameMode === '1P' ? player1Score : Math.max(player1Score, player2Score);
                    const percentage = totalQuestions > 0 ? ((finalScore / 10) / totalQuestions * 100).toFixed(1) : 0;
                    
                    const newRecord = {
                        name: gameMode === '1P' ? player1Name : `${player1Name} vs ${player2Name}`,
                        subject,
                        grade,
                        difficulty,
                        score: finalScore,
                        percentage: parseFloat(percentage),
                        coins,
                        date: new Date().toLocaleDateString('pt-BR')
                    };
                    
                    setRanking(prev => [...prev, newRecord].sort((a, b) => b.score - a.score));
                    setRecordSaved(true);
                }
                
                if (screen !== 'gameover' && recordSaved) {
                    setRecordSaved(false);
                }
            }, [screen, recordSaved, player1Score, player2Score, totalQuestions, gameMode, player1Name, player2Name, subject, grade, difficulty, coins]);

            // Splash screen autom√°tico
            useEffect(() => {
                if (screen === 'splash') {
                    if (synthRef.current && audioInitialized) {
                        const now = Tone.now();
                        synthRef.current.triggerAttackRelease('B5', '0.08', now);
                        synthRef.current.triggerAttackRelease('E6', '0.25', now + 0.08);
                    }
                    
                    setTimeout(() => setFadeOut(true), 2500);
                    setTimeout(() => {
                        setFadeOut(false);
                        setScreen('menu');
                    }, 3000);
                }
            }, [screen, audioInitialized]);

            // Iniciar √°udio
            const startIntro = async () => {
                try {
                    await Tone.start();
                    setAudioInitialized(true);
                    
                    if (!synthRef.current) {
                        synthRef.current = new Tone.Synth({
                            oscillator: { type: 'square' },
                            envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 0.1 }
                        }).toDestination();
                    }
                    
                    setScreen('splash');
                } catch (error) {
                    console.log('Audio failed, continuing anyway');
                    setScreen('splash');
                }
            };

            // Tocar sons
            const playSound = (type) => {
                if (!soundEnabled || !audioInitialized || !synthRef.current) return;
                
                const now = Tone.now();
                
                switch(type) {
                    case 'click':
                        synthRef.current.triggerAttackRelease('C4', '0.05', now);
                        break;
                    case 'pipe':
                        const pipeNotes = ['B5', 'A#5', 'A5', 'G#5', 'G5', 'F#5', 'F5', 'E5', 'D#5', 'D5', 'C#5', 'C5', 'B4', 'A#4', 'A4'];
                        pipeNotes.forEach((note, i) => {
                            synthRef.current.triggerAttackRelease(note, '0.05', now + i * 0.04);
                        });
                        break;
                    case 'celebration':
                        const celebNotes = ['C5', 'E5', 'G5', 'C6', 'G5', 'E5', 'C5', 'G5', 'C6'];
                        celebNotes.forEach((note, i) => {
                            synthRef.current.triggerAttackRelease(note, '0.15', now + i * 0.08);
                        });
                        break;
                    case 'coin':
                        synthRef.current.triggerAttackRelease('B5', '0.05', now);
                        synthRef.current.triggerAttackRelease('E6', '0.15', now + 0.05);
                        break;
                    case 'wrong':
                        synthRef.current.triggerAttackRelease('E3', '0.4', now);
                        synthRef.current.triggerAttackRelease('D3', '0.4', now + 0.2);
                        synthRef.current.triggerAttackRelease('C3', '0.6', now + 0.4);
                        break;
                    case 'powerup':
                        const powerNotes = ['C4', 'E4', 'G4', 'C5', 'E5', 'G5', 'C6'];
                        powerNotes.forEach((note, i) => {
                            synthRef.current.triggerAttackRelease(note, '0.08', now + i * 0.06);
                        });
                        break;
                    case 'gameover':
                        ['E4', 'D4', 'C4', 'G3', 'E3'].forEach((note, i) => {
                            synthRef.current.triggerAttackRelease(note, '0.2', now + i * 0.15);
                        });
                        break;
                    case 'start':
                        synthRef.current.triggerAttackRelease('E5', '0.1', now);
                        synthRef.current.triggerAttackRelease('E5', '0.1', now + 0.15);
                        synthRef.current.triggerAttackRelease('E5', '0.2', now + 0.3);
                        synthRef.current.triggerAttackRelease('C5', '0.1', now + 0.5);
                        synthRef.current.triggerAttackRelease('E5', '0.3', now + 0.6);
                        break;
                }
            };

            // Parar todas as m√∫sicas
            const stopAllMusic = () => {
                if (bgMusicPartRef.current) {
                    bgMusicPartRef.current.stop();
                    bgMusicPartRef.current.dispose();
                    bgMusicPartRef.current = null;
                }
                if (bgMusicRef.current) {
                    bgMusicRef.current.dispose();
                    bgMusicRef.current = null;
                }
                Tone.Transport.stop();
                Tone.Transport.cancel();
            };

            // M√∫sicas de fundo
            const startMenuMusic = () => {
                if (!soundEnabled || !audioInitialized) return;
                stopAllMusic();
                
                const synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: { type: 'sine' },
                    envelope: { attack: 0.1, decay: 0.3, sustain: 0.6, release: 0.8 }
                }).toDestination();
                
                synth.volume.value = -12;
                
                const melody = [
                    ['C4', 'E4', 'G4'], null, ['E4', 'G4', 'C5'], null,
                    ['D4', 'F4', 'A4'], null, ['F4', 'A4', 'D5'], null,
                    ['E4', 'G4', 'B4'], null, ['G4', 'B4', 'E5'], null,
                    ['C4', 'E4', 'G4'], null, ['G3', 'C4', 'E4'], null
                ];
                
                const part = new Tone.Part((time, chord) => {
                    if (chord) synth.triggerAttackRelease(chord, '0.8', time);
                }, melody.map((chord, i) => [i * 0.6, chord]));
                
                part.loop = true;
                part.loopEnd = melody.length * 0.6 + 's';
                Tone.Transport.bpm.value = 90;
                part.start(0);
                Tone.Transport.start();
                
                bgMusicRef.current = synth;
                bgMusicPartRef.current = part;
            };

            const startConfigMusic = () => {
                if (!soundEnabled || !audioInitialized) return;
                stopAllMusic();
                
                const synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: { type: 'triangle' },
                    envelope: { attack: 0.08, decay: 0.2, sustain: 0.7, release: 0.9 }
                }).toDestination();
                
                synth.volume.value = -14;
                
                const melody = [
                    ['G4', 'B4', 'D5'], null, ['B4', 'D5', 'G5'], null,
                    ['A4', 'C5', 'E5'], null, ['C5', 'E5', 'A5'], null,
                    ['F4', 'A4', 'C5'], null, ['A4', 'C5', 'F5'], null,
                    ['G4', 'B4', 'D5'], null, ['D4', 'G4', 'B4'], null
                ];
                
                const part = new Tone.Part((time, chord) => {
                    if (chord) synth.triggerAttackRelease(chord, '1.0', time);
                }, melody.map((chord, i) => [i * 0.7, chord]));
                
                part.loop = true;
                part.loopEnd = melody.length * 0.7 + 's';
                Tone.Transport.bpm.value = 85;
                part.start(0);
                Tone.Transport.start();
                
                bgMusicRef.current = synth;
                bgMusicPartRef.current = part;
            };

            const startGameMusic = () => {
                if (!soundEnabled || !audioInitialized) return;
                stopAllMusic();
                
                const synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: { type: 'triangle' },
                    envelope: { attack: 0.05, decay: 0.3, sustain: 0.4, release: 0.5 }
                }).toDestination();
                
                synth.volume.value = -14;
                
                const melody = [
                    'D3', 'D3', null, 'D#3', null, 'D3', null, null,
                    'C3', 'C3', null, 'C#3', null, 'C3', null, null,
                    'B2', 'B2', null, 'C3', null, 'B2', null, null,
                    'A2', 'A2', null, 'A#2', null, 'A2', null, null
                ];
                
                const part = new Tone.Part((time, note) => {
                    if (note) synth.triggerAttackRelease(note, '0.3', time);
                }, melody.map((note, i) => [i * 0.25, note]));
                
                part.loop = true;
                part.loopEnd = melody.length * 0.25 + 's';
                Tone.Transport.bpm.value = 80;
                part.start(0);
                Tone.Transport.start();
                
                bgMusicRef.current = synth;
                bgMusicPartRef.current = part;
            };

            const startRankingMusic = () => {
                if (!soundEnabled || !audioInitialized) return;
                stopAllMusic();
                
                const synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: { type: 'triangle' },
                    envelope: { attack: 0.02, decay: 0.3, sustain: 0.6, release: 0.4 }
                }).toDestination();
                
                synth.volume.value = -16;
                
                const melody = [
                    ['C5', 'E5', 'G5'], ['D5', 'F5', 'A5'], 
                    ['E5', 'G5', 'B5'], ['C5', 'E5', 'G5']
                ];
                
                const part = new Tone.Part((time, chord) => {
                    synth.triggerAttackRelease(chord, '0.6', time);
                }, melody.map((chord, i) => [i * 0.6, chord]));
                
                part.loop = true;
                part.loopEnd = '2.4s';
                Tone.Transport.bpm.value = 100;
                part.start(0);
                Tone.Transport.start();
                
                bgMusicRef.current = synth;
                bgMusicPartRef.current = part;
            };

            // Cleanup de m√∫sicas
            useEffect(() => {
                return () => {
                    stopAllMusic();
                    if (synthRef.current) synthRef.current.dispose();
                };
            }, []);

            // Gerenciar m√∫sicas por tela
            useEffect(() => {
                if (!audioInitialized || !soundEnabled) return;
                if (screen === 'splash' || screen === 'prestart' || screen === 'loading') {
                    stopAllMusic();
                    return;
                }
                
                const timer = setTimeout(() => {
                    if (screen === 'menu') startMenuMusic();
                    else if (screen === 'config') startConfigMusic();
                    else if (screen === 'question') startGameMusic();
                    else if (screen === 'ranking') startRankingMusic();
                    else if (screen === 'gameover') stopAllMusic();
                }, 100);
                
                return () => clearTimeout(timer);
            }, [screen, audioInitialized, soundEnabled]);

            // Toggle de som
            const toggleSound = async () => {
                const newState = !soundEnabled;
                setSoundEnabled(newState);
                
                if (newState && !audioInitialized) {
                    try {
                        await Tone.start();
                        setAudioInitialized(true);
                    } catch (error) {
                        console.log('Audio init failed');
                    }
                } else if (!newState) {
                    stopAllMusic();
                }
            };

            // Transi√ß√£o entre telas
            const transitionToScreen = (newScreen) => {
                playSound('click');
                setIsTransitioning(true);
                
                setTimeout(() => {
                    setScreen(newScreen);
                    setTimeout(() => setIsTransitioning(false), 500);
                }, 500);
            };

            // Gerar pergunta
            const generateQuestion = async () => {
                setIsGenerating(true);
                setScreen('loading');
                
                setTimeout(() => playSound('pipe'), 150);

                try {
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            messages: [{
                                role: "user",
                                content: `Crie uma pergunta de m√∫ltipla escolha para alunos da s√©rie "${grade}" sobre o tema "${topic}" da disciplina "${subject}". Dificuldade: "${difficulty}". Responda APENAS com JSON v√°lido: {"pergunta":"...","alternativas":{"A":"...","B":"...","C":"...","D":"..."},"correta":"A","explicacao":"..."}`
                            }]
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        let text = data.content[0].text.trim().replace(/```json\s*/g, '').replace(/```\s*/g, '');
                        const question = JSON.parse(text);
                        setCurrentQuestion(question);
                        setIsGenerating(false);
                        setScreen('question');
                        setSelectedAnswer('');
                    } else {
                        throw new Error('API error');
                    }
                } catch (error) {
                    console.log('Using fallback');
                    setCurrentQuestion({
                        pergunta: `Quest√£o sobre ${topic} (${subject} - ${grade})`,
                        alternativas: {
                            A: "Primeira alternativa",
                            B: "Segunda alternativa (Correta)",
                            C: "Terceira alternativa",
                            D: "Quarta alternativa"
                        },
                        correta: "B",
                        explicacao: "Esta √© uma quest√£o de exemplo. Configure a API Claude para gerar perguntas reais."
                    });
                    setIsGenerating(false);
                    setScreen('question');
                    setSelectedAnswer('');
                }
            };

            // Iniciar jogo
            const startGame = () => {
                if (!player1Name || (gameMode === '2P' && !player2Name)) {
                    alert('Digite o nome dos jogadores!');
                    return;
                }
                if (!subject || !grade || !topic) {
                    alert('Preencha todos os campos!');
                    return;
                }
                
                playSound('start');
                setPlayer1Score(0);
                setPlayer2Score(0);
                setCurrentPlayer(1);
                setLives(3);
                setStreak(0);
                setTotalQuestions(0);
                setMarioPosition(10);
                setCoins(0);
                
                setTimeout(() => generateQuestion(), 500);
            };

            // Verificar resposta
            const checkAnswer = () => {
                if (!selectedAnswer) {
                    alert('Selecione uma alternativa!');
                    return;
                }
                
                setTotalQuestions(totalQuestions + 1);
                const correct = selectedAnswer.toUpperCase() === currentQuestion.correta.toUpperCase();

                if (correct) {
                    playSound('celebration');
                    playSound('coin');
                    
                    const newScore = (currentPlayer === 1 ? player1Score : player2Score) + 10;
                    if (currentPlayer === 1) setPlayer1Score(newScore);
                    else setPlayer2Score(newScore);
                    
                    setStreak(streak + 1);
                    setCoins(coins + 1);
                    setMarioPosition(Math.min(marioPosition + 10, 85));

                    if (gameMode === '1P' && streak + 1 >= 3) {
                        setLives(lives + 1);
                        setStreak(0);
                        playSound('powerup');
                    }

                    setExplanationData({
                        correct: true,
                        text: currentQuestion.explicacao || 'Parab√©ns!'
                    });
                    setShowExplanation(true);
                } else {
                    playSound('wrong');
                    const newLives = lives - 1;
                    setLives(newLives);
                    setStreak(0);
                    
                    setExplanationData({
                        correct: false,
                        text: currentQuestion.explicacao || `Correta: ${currentQuestion.correta}`
                    });
                    setShowExplanation(true);
                    
                    if (newLives <= 0) {
                        setTimeout(() => {
                            setShowExplanation(false);
                            playSound('gameover');
                            transitionToScreen('gameover');
                        }, 5000);
                        return;
                    }
                }

                if (gameMode === '2P') {
                    setCurrentPlayer(currentPlayer === 1 ? 2 : 1);
                }
            };

            // Fechar explica√ß√£o
            const closeExplanation = () => {
                playSound('click');
                setShowExplanation(false);
                
                if (lives <= 0) {
                    playSound('gameover');
                    setTimeout(() => transitionToScreen('gameover'), 500);
                } else {
                    setTimeout(() => generateQuestion(), 300);
                }
            };

            // RENDERIZA√á√ïES DAS TELAS
            
            // TELA PRE-START
            if (screen === 'prestart') {
                return (
                    <div className={isTransitioning ? 'iris-out' : ''}>
                        <div className="min-h-screen bg-black flex items-center justify-center">
                            <div className="text-center">
                                <h1 className="text-white text-4xl font-bold mb-12 animate-pulse pixel-font" style={{textShadow: '3px 3px 0px #666'}}>
                                    PRESS START
                                </h1>
                                <button onClick={startIntro} className="bg-white text-black font-bold py-6 px-12 rounded-lg text-2xl border-4 border-gray-400 hover:bg-gray-200 transform hover:scale-110 transition-all shadow-2xl" style={{animation: 'bounce 1s ease-in-out infinite'}}>
                                    START
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA SPLASH
            if (screen === 'splash') {
                return (
                    <div className={`min-h-screen bg-black flex items-center justify-center transition-opacity duration-500 ${fadeOut ? 'opacity-0' : 'opacity-100'}`}>
                        <div className="text-center">
                            <div className="text-white text-4xl font-bold pixel-font" style={{textShadow: '2px 2px 0px #666'}}>
                                MARCEL DANCINI
                            </div>
                            <div className="text-white text-xl pixel-font mt-4">Presents</div>
                        </div>
                    </div>
                );
            }

            // TELA MENU
            if (screen === 'menu') {
                return (
                    <div className={isTransitioning ? 'iris-out' : 'iris-in'}>
                        <div className="min-h-screen bg-gradient-to-b from-blue-400 via-blue-300 to-green-400 p-8">
                            <button onClick={toggleSound} className="fixed top-6 right-6 bg-gradient-to-br from-yellow-400 to-orange-500 border-4 border-yellow-700 text-white p-4 rounded-full shadow-2xl z-50">
                                <span style={{fontSize: '24px'}}>{soundEnabled ? '‚ô™ ON' : '‚úï OFF'}</span>
                            </button>

                            <div className="max-w-4xl mx-auto">
                                <h1 className="text-5xl md:text-6xl font-bold text-yellow-300 text-center mb-8 pixel-font" style={{textShadow: '6px 6px 0px rgba(0,0,0,0.5)', animation: 'bounce 1s ease-in-out infinite'}}>
                                    QUIZ DO CONHECIMENTO
                                </h1>

                                <div className="space-y-4">
                                    <button onClick={() => transitionToScreen('config')} className="w-full bg-gradient-to-r from-orange-500 to-orange-600 border-4 border-orange-800 text-white font-bold py-6 px-8 rounded-lg text-xl md:text-2xl shadow-xl hover:scale-105 transition-all flex items-center justify-center gap-3">
                                        ‚≠ê INICIAR JOGO
                                    </button>
                                    <button onClick={() => transitionToScreen('ranking')} className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 border-4 border-yellow-800 text-white font-bold py-6 px-8 rounded-lg text-xl md:text-2xl shadow-xl hover:scale-105 transition-all flex items-center justify-center gap-3">
                                        üèÜ VER RANKING
                                    </button>
                                </div>

                                <div className="mt-12 text-center">
                                    <div className="text-8xl inline-block" style={{animation: 'bounce 1s ease-in-out infinite, rainbow 3s linear infinite'}}>
                                        üèÉ‚Äç‚ôÇÔ∏è
                                    </div>
                                </div>

                                <div className="mt-8 h-16 bg-gradient-to-b from-green-600 to-green-800 border-t-4 border-green-900"></div>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA CONFIG
            if (screen === 'config') {
                return (
                    <div className={isTransitioning ? 'iris-out' : 'iris-in'}>
                        <div className="min-h-screen bg-gradient-to-b from-blue-400 to-green-400 p-8">
                            <button onClick={toggleSound} className="fixed top-6 right-6 bg-gradient-to-br from-yellow-400 to-orange-500 border-4 border-yellow-700 text-white p-4 rounded-full shadow-2xl z-50">
                                <span style={{fontSize: '24px'}}>{soundEnabled ? '‚ô™ ON' : '‚úï OFF'}</span>
                            </button>
                            
                            <div className="max-w-3xl mx-auto bg-white border-8 border-gray-800 rounded-lg p-8 shadow-2xl">
                                <h2 className="text-2xl md:text-3xl font-bold text-center mb-6 text-red-600">‚öôÔ∏è CONFIGURA√á√ïES</h2>

                                <div className="mb-6">
                                    <label className="block text-lg font-bold mb-3">Modo de Jogo:</label>
                                    <div className="flex gap-4">
                                        <button onClick={() => { playSound('click'); setGameMode('1P'); }} className={`flex-1 py-4 rounded-lg border-4 font-bold ${gameMode === '1P' ? 'bg-red-500 text-white' : 'bg-gray-200'}`}>
                                            üë§ 1 Jogador
                                        </button>
                                        <button onClick={() => { playSound('click'); setGameMode('2P'); }} className={`flex-1 py-4 rounded-lg border-4 font-bold ${gameMode === '2P' ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
                                            üë• 2 Jogadores
                                        </button>
                                    </div>
                                </div>

                                <div className="space-y-4 mb-6">
                                    <input type="text" value={player1Name} onChange={(e) => setPlayer1Name(e.target.value)} placeholder="Nome Jogador 1" className="w-full px-4 py-3 border-4 border-gray-600 rounded-lg text-lg font-bold" />
                                    {gameMode === '2P' && <input type="text" value={player2Name} onChange={(e) => setPlayer2Name(e.target.value)} placeholder="Nome Jogador 2" className="w-full px-4 py-3 border-4 border-gray-600 rounded-lg text-lg font-bold" />}
                                    <input type="text" value={subject} onChange={(e) => setSubject(e.target.value)} placeholder="üìö Disciplina" className="w-full px-4 py-3 border-4 border-gray-600 rounded-lg text-lg" />
                                    <input type="text" value={grade} onChange={(e) => setGrade(e.target.value)} placeholder="üéì S√©rie" className="w-full px-4 py-3 border-4 border-gray-600 rounded-lg text-lg" />
                                    <input type="text" value={topic} onChange={(e) => setTopic(e.target.value)} placeholder="üìñ Conte√∫do" className="w-full px-4 py-3 border-4 border-gray-600 rounded-lg text-lg" />
                                    
                                    <div>
                                        <label className="block text-lg font-bold mb-2">‚ö° Dificuldade:</label>
                                        <div className="flex gap-3">
                                            {['F√°cil', 'M√©dio', 'Dif√≠cil'].map(d => (
                                                <button key={d} onClick={() => { playSound('click'); setDifficulty(d); }} className={`flex-1 py-3 rounded-lg border-4 font-bold ${difficulty === d ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}>
                                                    {d}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-4">
                                    <button onClick={() => transitionToScreen('menu')} className="flex-1 bg-gray-500 text-white font-bold py-4 rounded-lg text-xl">
                                        ‚Üê VOLTAR
                                    </button>
                                    <button onClick={startGame} className="flex-1 bg-green-500 text-white font-bold py-4 rounded-lg text-xl">
                                        COME√áAR ‚Üí
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA LOADING
            if (screen === 'loading') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-9xl mb-8" style={{animation: 'bounce 0.8s ease-in-out infinite, spin 2s linear infinite'}}>
                                üçÑ
                            </div>
                            <h2 className="text-3xl md:text-4xl font-bold text-white">
                                Gerando pergunta{'.'.repeat(dots)}
                            </h2>
                        </div>
                    </div>
                );
            }

            // TELA QUESTION
            if (screen === 'question' && currentQuestion) {
                const currentPlayerName = currentPlayer === 1 ? player1Name : player2Name;

                return (
                    <div className="min-h-screen bg-gradient-to-b from-blue-400 to-green-400 p-4">
                        <button onClick={toggleSound} className="fixed top-6 right-6 bg-gradient-to-br from-yellow-400 to-orange-500 border-4 border-yellow-700 text-white p-4 rounded-full shadow-2xl z-50">
                            <span style={{fontSize: '24px'}}>{soundEnabled ? '‚ô™ ON' : '‚úï OFF'}</span>
                        </button>

                        {showExplanation && (
                            <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50">
                                <div className={`max-w-2xl w-full ${explanationData.correct ? 'bg-green-500' : 'bg-red-500'} border-8 border-white rounded-lg p-8`}>
                                    <div className="text-center mb-6">
                                        <div className="text-9xl mb-4">{explanationData.correct ? 'üéâ' : '‚ùå'}</div>
                                        <h2 className="text-4xl md:text-5xl font-bold text-white mb-2">
                                            {explanationData.correct ? 'CORRETO!' : 'INCORRETO!'}
                                        </h2>
                                        <p className="text-2xl text-white">Resposta: {currentQuestion.correta}</p>
                                        {explanationData.correct && (
                                            <div className="text-xl text-white mt-4">
                                                ‚úÖ +10 pontos | ü™ô +1 moeda
                                            </div>
                                        )}
                                    </div>

                                    <div className="bg-white bg-opacity-20 rounded-lg p-6 mb-6">
                                        <h3 className="text-2xl font-bold text-white mb-4">üìñ Explica√ß√£o:</h3>
                                        <p className="text-lg text-white">{explanationData.text}</p>
                                    </div>

                                    <button onClick={closeExplanation} className={`w-full ${explanationData.correct ? 'bg-yellow-400' : 'bg-white'} text-gray-900 font-bold py-6 rounded-lg text-xl`}>
                                        {explanationData.correct ? 'üéÆ PR√ìXIMA ‚Üí' : 'üìö CONTINUAR ‚Üí'}
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="max-w-5xl mx-auto">
                            <div className="bg-black text-white p-4 rounded-lg mb-4 border-4 border-gray-700">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <div className="text-xl md:text-2xl font-bold">
                                            {gameMode === '1P' ? `üéÆ ${player1Name}` : `üéÆ VEZ: ${currentPlayerName}`}
                                        </div>
                                        <div className="text-lg">
                                            {gameMode === '2P' ? `${player1Name}: ${player1Score} | ${player2Name}: ${player2Score}` : `PONTOS: ${player1Score}`}
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-2xl">{'‚ù§Ô∏è'.repeat(lives)} VIDAS</div>
                                        <div className="text-xl">ü™ô x {coins} | ‚ö° {streak}/3</div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gradient-to-b from-sky-300 to-sky-400 p-4 rounded-lg mb-4 border-4 border-blue-600 relative h-32">
                                <div className="absolute top-4 left-10 text-3xl" style={{animation: 'bounce 1s ease-in-out infinite'}}>‚òÅÔ∏è</div>
                                <div className="absolute top-6 right-20 text-4xl" style={{animation: 'bounce 1s ease-in-out infinite', animationDelay: '0.3s'}}>‚òÅÔ∏è</div>
                                <div className="absolute bottom-4 transition-all duration-200 text-6xl" style={{left: `${marioPosition}%`, animation: marioPosition < 85 ? 'walk 0.4s steps(2) infinite' : 'none'}}>
                                    üèÉ‚Äç‚ôÇÔ∏è
                                </div>
                                <div className="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-b from-yellow-700 to-yellow-900 border-t-4 border-yellow-600"></div>
                            </div>

                            <div className="bg-yellow-400 border-8 border-yellow-600 rounded-lg p-6 mb-6">
                                <div className="flex items-start gap-4">
                                    <div className="text-6xl">‚ùì</div>
                                    <div>
                                        <h3 className="text-2xl font-bold mb-3">PERGUNTA:</h3>
                                        <p className="text-xl">{currentQuestion.pergunta}</p>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-3 mb-6">
                                {Object.entries(currentQuestion.alternativas).map(([key, value]) => (
                                    <button key={key} onClick={() => { playSound('click'); setSelectedAnswer(key); }} className={`w-full text-left p-5 rounded-lg border-4 font-bold text-lg transition-all ${selectedAnswer === key ? 'bg-red-500 border-red-700 text-white shadow-xl scale-105' : 'bg-orange-400 border-orange-600 hover:bg-orange-500'}`}>
                                        <span className="text-2xl mr-3">üß±</span>
                                        {key}) {value}
                                    </button>
                                ))}
                            </div>

                            <button onClick={checkAnswer} className="w-full bg-gradient-to-r from-green-500 to-green-600 border-4 border-green-800 text-white font-bold py-6 rounded-lg text-2xl shadow-xl hover:scale-105 transition-all">
                                ‚úÖ RESPONDER!
                            </button>
                        </div>
                    </div>
                );
            }

            // TELA GAME OVER
            if (screen === 'gameover') {
                const winner = player1Score > player2Score ? player1Name : player2Score > player1Score ? player2Name : 'EMPATE';
                const finalScore = gameMode === '1P' ? player1Score : Math.max(player1Score, player2Score);
                const percentage = totalQuestions > 0 ? ((finalScore / 10) / totalQuestions * 100).toFixed(1) : 0;

                return (
                    <div className={isTransitioning ? 'iris-out' : 'iris-in'}>
                        <div className="min-h-screen bg-gradient-to-b from-gray-800 to-black p-8 flex items-center justify-center">
                            <button onClick={toggleSound} className="fixed top-6 right-6 bg-gradient-to-br from-yellow-400 to-orange-500 border-4 border-yellow-700 text-white p-4 rounded-full shadow-2xl z-50">
                                <span style={{fontSize: '24px'}}>{soundEnabled ? '‚ô™ ON' : '‚úï OFF'}</span>
                            </button>
                            
                            <div className="max-w-3xl w-full bg-red-900 border-8 border-red-600 rounded-lg p-8 text-center">
                                <div className="text-8xl mb-6" style={{animation: 'bounce 1s ease-in-out infinite'}}>üíÄ</div>
                                <h1 className="text-4xl md:text-6xl font-bold text-yellow-300 mb-6 pixel-font">GAME OVER!</h1>

                                <div className="bg-black text-white p-6 rounded-lg mb-6 border-4 border-gray-700">
                                    {gameMode === '1P' ? (
                                        <>
                                            <p className="text-3xl mb-4">{player1Name}</p>
                                            <p className="text-5xl font-bold text-yellow-400">{player1Score} PONTOS</p>
                                        </>
                                    ) : (
                                        <>
                                            <p className="text-2xl">{player1Name}: {player1Score} | {player2Name}: {player2Score}</p>
                                            <p className="text-4xl font-bold text-yellow-400 mt-4">VENCEDOR: {winner}!</p>
                                        </>
                                    )}
                                    <div className="text-2xl mt-6">
                                        <p>ü™ô Moedas: {coins}</p>
                                        <p>üìä Aproveitamento: {percentage}%</p>
                                    </div>
                                    {recordSaved && (
                                        <div className="mt-4 bg-green-500 border-2 border-green-700 rounded-lg p-3">
                                            <p className="font-bold">‚úÖ Recorde salvo!</p>
                                        </div>
                                    )}
                                </div>

                                <div className="space-y-4">
                                    <button onClick={() => transitionToScreen('config')} className="w-full bg-green-500 border-4 border-green-700 text-white font-bold py-4 rounded-lg text-xl">
                                        üîÑ JOGAR NOVAMENTE
                                    </button>
                                    <button onClick={() => transitionToScreen('ranking')} className="w-full bg-yellow-500 border-4 border-yellow-700 text-white font-bold py-4 rounded-lg text-xl">
                                        üèÜ VER RANKING
                                    </button>
                                    <button onClick={() => transitionToScreen('menu')} className="w-full bg-red-500 border-4 border-red-700 text-white font-bold py-4 rounded-lg text-xl">
                                        üè† MENU
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // TELA RANKING
            if (screen === 'ranking') {
                return (
                    <div className={isTransitioning ? 'iris-out' : 'iris-in'}>
                        <div className="min-h-screen bg-gradient-to-b from-purple-600 to-purple-900 p-8">
                            <button onClick={toggleSound} className="fixed top-6 right-6 bg-gradient-to-br from-yellow-400 to-orange-500 border-4 border-yellow-700 text-white p-4 rounded-full shadow-2xl z-50">
                                <span style={{fontSize: '24px'}}>{soundEnabled ? '‚ô™ ON' : '‚úï OFF'}</span>
                            </button>
                            
                            <div className="max-w-5xl mx-auto">
                                <div className="bg-yellow-400 border-8 border-yellow-600 rounded-lg p-6 mb-8 text-center">
                                    <h1 className="text-4xl md:text-5xl font-bold text-red-600 pixel-font" style={{animation: 'bounce 1s ease-in-out infinite'}}>
                                        üèÜ HALL DA FAMA üèÜ
                                    </h1>
                                    <p className="text-lg mt-2">Total: {ranking.length}</p>
                                </div>

                                <div className="bg-white border-8 border-gray-800 rounded-lg p-6 mb-6">
                                    {ranking.length === 0 ? (
                                        <div className="text-center py-8">
                                            <p className="text-2xl text-gray-600 mb-4">Nenhum recorde! üò¢</p>
                                            <p className="text-xl text-gray-500">Jogue e seja o primeiro! üåü</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {ranking.slice(0, 10).map((r, i) => (
                                                <div key={i} className={`p-4 rounded-lg border-4 ${i === 0 ? 'bg-yellow-200 border-yellow-500' : i === 1 ? 'bg-gray-200 border-gray-400' : i === 2 ? 'bg-orange-200 border-orange-400' : 'bg-blue-50 border-blue-300'}`}>
                                                    <div className="flex items-center justify-between">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-3xl font-bold">
                                                                {i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `#${i + 1}`}
                                                            </span>
                                                            <div>
                                                                <div className="font-bold text-lg">{r.name}</div>
                                                                <div className="text-sm text-gray-600">{r.subject} | {r.grade}</div>
                                                            </div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-blue-600">{r.score} pts</div>
                                                            <div className="text-sm">ü™ô {r.coins} | üìä {r.percentage}%</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <button onClick={() => transitionToScreen('menu')} className="w-full bg-red-500 border-4 border-red-700 text-white font-bold py-4 rounded-lg text-xl">
                                    ‚Üê VOLTAR
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MarioQuizGame />);
    </script>
</body>
</html>
